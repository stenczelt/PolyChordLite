# This workflow carries out the build of the package with CMake

name: CMake build

on: [ push ]

jobs:
  build-GNU:
    runs-on: ubuntu-latest

    steps:
      # check out
      - uses: actions/checkout@v2

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install gfortran libopenmpi-dev cmake python3-dev pip
          pip install scipy matplotlib getdist anesthetic ipython

      - name: Run CMake builid
        run: |
          mkdir BUILD_GNU
          cd BUILD_GNU
          cmake ..
          make install

  build-Intel:
    runs-on: ubuntu-latest
    container:
      image: intel/oneapi-hpckit

    steps:
      # check out
      - uses: actions/checkout@v2

      - name: Run CMake builid
        run: |
          mkdir BUILD_Intel
          cd BUILD_Intel
          cmake -DCMAKE_CXX_COMPILER=icpc -DCMAKE_Fortran_COMPILER=ifort ..
          make install

  build-MacOS:
    runs-on: macos-latest

    steps:
      # check out
      - uses: actions/checkout@v2

      - name: Install dependencies
        run: |
          brew install cmake gcc openmpi
          pip install scipy matplotlib getdist anesthetic ipython

      - name: Check versions
        run: |
          cmake --version
          gcc-11 --version
          gfortran-11 --version

      - name: Run CMake builid
        run: |
          mkdir BUILD_GNU_MacOS
          cd BUILD_GNU_MacOS
          cmake -DCMAKE_Fortran_COMPILER=gfortran-11 -DCMAKE_CXX_COMPILER=gcc-11 ..
          make VERBOSE=1 install
